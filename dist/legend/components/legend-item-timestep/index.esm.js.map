{"version":3,"file":"index.esm.js","sources":["../../../../src/components/legend/components/legend-item-timestep/index.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport isEqual from 'lodash/isEqual';\nimport classnames from 'classnames';\n\nimport Timestep from 'components/timestep';\n\nimport {\n  addToDate,\n  dateDiff,\n  gradientConverter,\n  formatDatePretty,\n  formatDate,\n  getTicks,\n} from './utils';\n\nimport './styles.scss';\n\nexport class TimestepContainer extends PureComponent {\n  timelineParams = null;\n\n  static propTypes = {\n    defaultStyles: PropTypes.shape({}),\n    activeLayer: PropTypes.shape({}),\n    handleChange: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = { defaultStyles: {}, activeLayer: {} };\n\n  constructor(props) {\n    super(props);\n    const { activeLayer } = props;\n    const { timelineParams } = activeLayer;\n\n    this.timelineParams = timelineParams;\n  }\n\n  componentDidUpdate(prevProps) {\n    const { activeLayer } = this.props;\n    const { activeLayer: prevActiveLayer } = prevProps;\n\n    const { timelineParams } = activeLayer;\n    const { timelineParams: prevTimelineParams } = prevActiveLayer;\n\n    // Should we use timelineParams directly from params instead of doing this? I think so\n    if (!isEqual(timelineParams, prevTimelineParams)) {\n      this.timelineParams = timelineParams;\n      this.forceUpdate();\n    }\n  }\n\n  getTrackStyle = () => {\n    const { minDate, interval, trackStyle } = this.timelineParams;\n\n    if (Array.isArray(trackStyle)) {\n      return trackStyle.map((t) => {\n        const { gradient } = t || {};\n\n        if (!gradient) return t;\n\n        const styles = {\n          ...t,\n          gradient: gradientConverter(gradient, minDate, interval),\n        };\n\n        return styles;\n      });\n    }\n\n    const { gradient } = trackStyle || {};\n\n    if (gradient) {\n      return {\n        ...trackStyle,\n        gradient: gradientConverter(gradient, minDate, interval),\n      };\n    }\n\n    return trackStyle;\n  };\n\n  handleOnAfterChange = (range) => {\n    const { activeLayer, handleChange } = this.props;\n    const formattedRange = this.formatRange([range[0], range[1], range[2]]);\n\n    handleChange(formattedRange, activeLayer);\n  };\n\n  formatRange = (range) => {\n    const { minDate, interval } = this.timelineParams;\n    return range.map((r, i) => {\n      // if date is not the start date we should select the end of the interval\n      const toEnd = i !== 0;\n\n      return formatDate(addToDate(minDate, r, interval, toEnd));\n    });\n  };\n\n  formatValue = (value) => {\n    const { minDate, dateFormat, interval } = this.timelineParams;\n    return formatDatePretty(addToDate(minDate, value, interval), dateFormat);\n  };\n\n  render() {\n    if (!this.timelineParams) return null;\n    const { defaultStyles } = this.props;\n    const {\n      marks,\n      maxDate,\n      maxAbsoluteDate,\n      minDate,\n      minAbsoluteDate,\n      interval,\n      startDate,\n      endDate,\n      trimEndDate,\n      canPlay,\n    } = this.timelineParams;\n\n    return (\n      <div\n        styleName={classnames({\n          'c-legend-timestep': true,\n          '-can-play': canPlay,\n        })}\n      >\n        <Timestep\n          {...this.props}\n          {...defaultStyles}\n          {...this.timelineParams}\n          trackStyle={this.getTrackStyle()}\n          min={0}\n          minAbs={dateDiff(minAbsoluteDate || minDate, minDate, interval, false)}\n          max={dateDiff(maxDate, minDate, interval)}\n          maxAbs={dateDiff(maxAbsoluteDate || maxDate, minDate, interval)}\n          start={dateDiff(startDate, minDate, interval)}\n          end={dateDiff(endDate, minDate, interval)}\n          trim={dateDiff(trimEndDate, minDate, interval)}\n          marks={marks || getTicks(this.timelineParams)}\n          formatValue={this.formatValue}\n          handleOnAfterChange={this.handleOnAfterChange}\n        />\n      </div>\n    );\n  }\n}\n\nexport default TimestepContainer;\n"],"names":["TimestepContainer","props","timelineParams","minDate","interval","trackStyle","Array","isArray","map","t","gradient","styles","gradientConverter","range","activeLayer","handleChange","formattedRange","formatRange","r","i","toEnd","formatDate","addToDate","value","dateFormat","formatDatePretty","prevProps","prevActiveLayer","prevTimelineParams","isEqual","forceUpdate","defaultStyles","marks","maxDate","maxAbsoluteDate","minAbsoluteDate","startDate","endDate","trimEndDate","canPlay","classnames","getTrackStyle","dateDiff","getTicks","formatValue","handleOnAfterChange","PureComponent","PropTypes","shape","func","isRequired"],"mappings":"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"}