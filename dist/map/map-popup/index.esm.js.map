{"version":3,"file":"index.esm.js","sources":["../../../src/components/map/map-popup/index.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { render } from 'react-dom';\n\nimport isEqual from 'lodash/isEqual';\n\nconst { L } = typeof window !== 'undefined' ? window : {};\n\nexport class MapPopup extends Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired,\n    /** Map instance */\n    map: PropTypes.object.isRequired,\n    /** `{ lat: 20, lng: 20 }` As soon as this changes, a popup will show up on the map */\n    latlng: PropTypes.object,\n    /** As soon as this changes, a popup will be updated on the map */\n    data: PropTypes.object,\n    /** Return a popup instace\n     * @param {Object} popup Popup instace\n     */\n    onReady: PropTypes.func,\n  };\n\n  static defaultProps = {\n    latlng: {},\n    data: {},\n    onReady: () => {},\n  };\n\n  componentDidMount() {\n    if (typeof L === 'undefined') {\n      return;\n    }\n\n    this.popup =\n      this.popup ||\n      L.popup({\n        maxWidth: 400,\n        minWidth: 240,\n      });\n\n    this.props.onReady(this.popup);\n  }\n\n  componentDidUpdate(prevProps) {\n    const { latlng: prevLatLng, data: prevData } = prevProps;\n\n    const { latlng: nextLatLng, data: nextData } = this.props;\n\n    if (!isEqual(prevLatLng, nextLatLng)) {\n      this.setPopup();\n    }\n\n    if (!isEqual(prevData, nextData) && prevLatLng) {\n      this.updatePopup();\n    }\n  }\n\n  setPopup = () => {\n    const { map, latlng } = this.props;\n\n    if (!latlng || !map) this.removePopup();\n\n    const content = this.buildPopup();\n\n    if (latlng && map) {\n      this.popup.setLatLng(latlng).setContent(content).openOn(map);\n    }\n  };\n\n  buildPopup = () => {\n    const { children } = this.props;\n    const popupComponent = document.createElement('div');\n\n    render(\n      React.Children.map(children, (child) =>\n        React.isValidElement(child) && typeof child.type !== 'string'\n          ? React.cloneElement(child, {\n              ...this.props,\n              popup: this.popup,\n            })\n          : child\n      ),\n      popupComponent\n    );\n    return popupComponent;\n  };\n\n  updatePopup = () => {\n    this.popup.setContent(this.buildPopup());\n  };\n\n  removePopup = () => {\n    if (this.popup) {\n      this.popup.remove();\n    }\n  };\n\n  render() {\n    return null;\n  }\n}\n\nexport default MapPopup;\n"],"names":["window","L","MapPopup","props","map","latlng","removePopup","content","buildPopup","popup","setLatLng","setContent","openOn","children","popupComponent","document","createElement","render","React","Children","child","isValidElement","type","cloneElement","remove","maxWidth","minWidth","onReady","prevProps","prevLatLng","prevData","data","nextLatLng","nextData","isEqual","setPopup","updatePopup","Component","PropTypes","node","isRequired","object","func"],"mappings":"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"}