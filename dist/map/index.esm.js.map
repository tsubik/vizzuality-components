{"version":3,"file":"index.esm.js","sources":["../../src/components/map/index.js"],"sourcesContent":["import React, { Component } from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\nimport isEqual from 'lodash/isEqual';\nimport './styles.scss';\n\nconst { L } = typeof window !== 'undefined' ? window : {};\n\nif (typeof window !== 'undefined') {\n  /*\n   * Workaround for 1px lines appearing in some browsers due to fractional transforms\n   * and resulting anti-aliasing.\n   * https://github.com/Leaflet/Leaflet/issues/3575\n   */\n  /* eslint-disable */\n  (function () {\n    const originalInitTile = L && L.GridLayer.prototype._initTile;\n    L && L.GridLayer.include({\n      _initTile(tile) {\n        originalInitTile.call(this, tile);\n        const tileSize = this.getTileSize();\n        tile.style.width = `${tileSize.x + 1  }px`;\n        tile.style.height = `${tileSize.y + 1  }px`;\n      }\n    });\n  }());\n  /* eslint-enable */\n}\n\nclass Maps extends Component {\n  events = {};\n\n  static propTypes = {\n    /** A function that returns the map instance */\n    children: PropTypes.func,\n    /** Custom css class for styling */\n    customClass: PropTypes.string,\n    /** Leaflet props for creating a map\n     * @see Check Leaflet documentation  https://leafletjs.com/reference-1.3.0.html#map\n     */\n    mapOptions: PropTypes.object,\n    /** `{ url: 'http://example/{x}/{y}/{z}', options: {}}`\n     * @see Check Leaflet documentation  https://leafletjs.com/reference-1.3.0.html#tilelayer\n     */\n    basemap: PropTypes.object,\n    /** `{ url: 'http://example/{x}/{y}/{z}', options: {} }` Options for L.tileLayer\n     * @see Check Leaflet documentation  https://leafletjs.com/reference-1.3.0.html#tilelayer\n     */\n    label: PropTypes.object,\n    /** `{ bbox: [10, 5, 20, 10], options: {} }`\n     * @see Check Leaflet documentation  https://leafletjs.com/reference-1.3.0.html#fitbounds-options\n     */\n    bounds: PropTypes.object,\n    /**\n     * `{ click: (e, map) => {} }` All the functions return 2 params\n     * @arg {Object} e event\n     * @arg {Object} map Map instance\n     * @see Cheack Leaflet documentation https://leafletjs.com/reference-1.3.0.html#map-event\n     */\n    events: PropTypes.object,\n    /** Removes all interactions available on the map  */\n    interactionEnabled: PropTypes.bool,\n    /** Removes only zoomScroll on the map  */\n    scrollZoomEnabled: PropTypes.bool,\n    /**\n     * Return map instance when this one is ready\n     * @arg {Object} map Map instance\n     */\n    onReady: PropTypes.func,\n  };\n\n  static defaultProps = {\n    children: null,\n    customClass: null,\n    mapOptions: {\n      zoomControl: false,\n      center: [27, 12],\n      zoom: 3,\n      maxZoom: 20,\n      minZoom: 2,\n    },\n    basemap: {\n      url: 'http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',\n      options: {\n        maxZoom: 20,\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n      },\n    },\n    label: {\n      url: 'http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png',\n      options: {\n        maxZoom: 20,\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n      },\n    },\n    bounds: {\n      bbox: null,\n      options: {}, // fitBounds options\n    },\n    events: {},\n    interactionEnabled: true,\n    scrollZoomEnabled: true,\n    onReady: () => {},\n  };\n\n  componentDidMount() {\n    if (typeof L === 'undefined' || !this.mapNode) {\n      return;\n    }\n\n    const { interactionEnabled, scrollZoomEnabled, onReady } = this.props;\n\n    this.setMap();\n\n    this.setBasemap();\n    this.setLabel();\n\n    this.setBounds();\n\n    this.setEvents();\n\n    if (!interactionEnabled) {\n      this.map.dragging.disable();\n      this.map.touchZoom.disable();\n      this.map.doubleClickZoom.disable();\n      this.map.scrollWheelZoom.disable();\n      this.map.boxZoom.disable();\n      this.map.keyboard.disable();\n    }\n\n    if (!scrollZoomEnabled) {\n      this.map.scrollWheelZoom.disable();\n    }\n\n    onReady(this.map);\n\n    // As this.map didn't exist before this function\n    this.forceUpdate();\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      basemap: prevBasemap,\n      label: prevLabel,\n      bounds: prevBounds,\n      events: prevEvents,\n      mapOptions: prevMapOptions,\n    } = prevProps;\n\n    const {\n      basemap: nextBasemap,\n      label: nextLabel,\n      bounds: nextBounds,\n      events: nextEvents,\n      mapOptions: nextMapOptions,\n    } = this.props;\n\n    // Basemap\n    if (!isEqual(prevBasemap, nextBasemap)) {\n      this.setBasemap();\n    }\n\n    // Label\n    if (!isEqual(prevLabel, nextLabel)) {\n      this.setLabel();\n    }\n\n    // Bounds\n    if (!isEqual(prevBounds, nextBounds)) {\n      this.setBounds();\n    }\n\n    // Events\n    if (!isEqual(prevEvents, nextEvents)) {\n      this.setEvents();\n    }\n\n    // mapOptions\n    if (!isEqual(prevMapOptions, nextMapOptions)) {\n      this.setMapOptions();\n    }\n  }\n\n  componentWillUnmount() {\n    this.removeEvents();\n  }\n\n  setMap = () => {\n    const { mapOptions } = this.props;\n    this.map = L.map(this.mapNode, { ...Maps.defaultProps.mapOptions, ...mapOptions });\n  };\n\n  setMapOptions = () => {\n    const {\n      mapOptions: { center, zoom },\n    } = this.props;\n    this.map.setView({ ...center }, zoom);\n  };\n\n  setBasemap = () => {\n    const { basemap } = this.props;\n\n    if (this.basemapLayer) this.basemapLayer.remove();\n\n    this.basemapLayer = L.tileLayer(basemap.url, basemap.options).addTo(this.map).setZIndex(0);\n  };\n\n  setLabel = () => {\n    const { label } = this.props;\n\n    if (this.labelLayer) this.labelLayer.remove();\n\n    this.labelLayer = L.tileLayer(label.url, label.options).addTo(this.map).setZIndex(1100);\n  };\n\n  setBounds = () => {\n    const { bounds } = this.props;\n    const { bbox, options } = bounds;\n\n    if (bbox) {\n      const mapBounds = [\n        [bbox[1], bbox[0]],\n        [bbox[3], bbox[2]],\n      ];\n\n      this.map.fitBounds(mapBounds, options);\n    }\n  };\n\n  setEvents() {\n    const { events } = this.props;\n\n    this.removeEvents();\n\n    Object.keys(events).forEach((key) => {\n      this.events[key] = (e) => {\n        events[key](e, this.map);\n      };\n\n      this.map.on(key, this.events[key]);\n    });\n  }\n\n  removeEvents() {\n    Object.keys(this.events).forEach((key) => {\n      this.map.off(key, this.events[key]);\n    });\n  }\n\n  render() {\n    const { customClass, children } = this.props;\n    const externalClass = classnames({ [customClass]: !!customClass });\n\n    return (\n      <div styleName=\"c-map\" className={externalClass}>\n        <div\n          ref={(node) => {\n            this.mapNode = node;\n          }}\n          styleName=\"map-container\"\n        />\n\n        {!!this.map && typeof children === 'function' && children(this.map)}\n      </div>\n    );\n  }\n}\n\nexport default Maps;\nexport { default as MapPopup } from './map-popup';\nexport { default as MapControls } from './map-controls';\nexport { default as ZoomControl } from './map-controls/zoom-control';\n"],"names":["window","L","originalInitTile","GridLayer","prototype","_initTile","include","tile","call","tileSize","getTileSize","style","width","x","height","y","Maps","mapOptions","props","map","mapNode","defaultProps","center","zoom","setView","basemap","basemapLayer","remove","tileLayer","url","options","addTo","setZIndex","label","labelLayer","bounds","bbox","mapBounds","fitBounds","interactionEnabled","scrollZoomEnabled","onReady","setMap","setBasemap","setLabel","setBounds","setEvents","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","forceUpdate","prevProps","prevBasemap","prevLabel","prevBounds","prevEvents","events","prevMapOptions","nextBasemap","nextLabel","nextBounds","nextEvents","nextMapOptions","isEqual","setMapOptions","removeEvents","Object","keys","forEach","key","e","on","off","customClass","children","externalClass","classnames","node","Component","PropTypes","func","string","object","bool","zoomControl","maxZoom","minZoom","attribution"],"mappings":"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"}